# CLAUDE.md ガイド

## 目次
- [CLAUDE.mdとは](#claudemdとは)
- [CLAUDE.mdの役割](#claudemdの役割)
- [メモリの階層構造](#メモリの階層構造)
- [CLAUDE.mdの作成方法](#claudemdの作成方法)
- [含めるべき内容](#含めるべき内容)
- [実践的な例](#実践的な例)
- [ベストプラクティス](#ベストプラクティス)

---

## CLAUDE.mdとは

`CLAUDE.md`は、Claude Codeがセッション間で記憶する**設定ファイル**です。

### 基本概念

- **プロジェクト固有の指示**を記載できる
- **コーディング規約**や**よく使うコマンド**を登録できる
- **セッション間で情報を保持**し、毎回同じ説明をする手間を省ける

**イメージ:**
CLAUDE.mdは、Claudeへの「メモ帳」や「取扱説明書」のようなものです。プロジェクトのルールや、覚えておいてほしいことを書いておくと、Claudeが自動的に読み取って動作します。

---

## CLAUDE.mdの役割

### なぜCLAUDE.mdが必要なのか?

Claude Codeは非常に賢いですが、プロジェクト固有の情報までは知りません。例えば:

- このプロジェクトで使っているコーディング規約
- よく実行するビルドやテストのコマンド
- 重要なディレクトリ構造やファイルの役割
- チームで決めた命名規則

これらの情報をCLAUDE.mdに書いておくことで、Claudeが自動的に理解し、適切に対応してくれます。

### CLAUDE.mdがある場合とない場合の違い

**CLAUDE.mdがない場合:**

```
あなた: テストを実行して

Claude: どのコマンドでテストを実行しますか? npm test? yarn test? それとも別のコマンド?

あなた: npm run test:unit です

Claude: わかりました。実行します。
```

**CLAUDE.mdがある場合:**

```markdown
## よく使うコマンド

- テスト実行: `npm run test:unit`
```

```
あなた: テストを実行して

Claude: 了解しました。`npm run test:unit`を実行します。
```

---

## メモリの階層構造

Claude Codeは、4つの階層でメモリを管理します。優先度は下に行くほど高くなります（下の設定が上書きします）。

### 1. 企業ポリシー（最も低い優先度）

**場所:** IT部門が管理する組織全体のルール

**用途:** セキュリティポリシーやコンプライアンス要件など

**例:**
- 「外部APIへの接続は禁止」
- 「個人情報を含むコードをコミットしない」

**個人開発者には関係ない場合が多い**

---

### 2. プロジェクトメモリ

**場所:** プロジェクトのルートディレクトリにある`CLAUDE.md`

**用途:** チーム内で共有される基準やプロジェクト固有の情報

**例:**
- プロジェクトの概要
- コーディング規約
- ビルド・テストコマンド
- ディレクトリ構造の説明

**初学者が最も使うのはこのレベル**

---

### 3. ユーザーメモリ

**場所:** `~/.config/claude/CLAUDE.md`（ホームディレクトリ）

**用途:** 全プロジェクト共通の個人設定

**例:**
- 好みのコーディングスタイル
- よく使う開発ツール
- 個人的な作業パターン

**個人開発者におすすめ**

---

### 4. ローカルメモリ（最も高い優先度）

**場所:** プロジェクトのルートディレクトリにある`.claude/CLAUDE.md`

**用途:** 現在のプロジェクトのみの個人設定

**非推奨:** 通常は「プロジェクトメモリ」で十分です

---

## CLAUDE.mdの作成方法

### 方法1: 自動生成（推奨・初心者向け）

プロジェクトディレクトリで、Claude Codeの対話モードを起動し、`/init`コマンドを実行します:

```bash
cd /path/to/your/project
claude
```

対話モードで:

```
/init
```

これにより、基本的なCLAUDE.mdファイルが自動生成されます。

---

### 方法2: 対話中に追加（`#`キー）

対話モード中に`#`キーを押すと、現在の会話内容をCLAUDE.mdに素早く追加できます。

**使い方:**
1. 対話モードで重要な情報を会話する
2. `#`キーを押す
3. CLAUDE.mdに追加する内容を確認・編集
4. 保存

---

### 方法3: 手動で作成

プロジェクトのルートディレクトリに`CLAUDE.md`ファイルを手動で作成することもできます:

```bash
cd /path/to/your/project
touch CLAUDE.md
```

エディタで開いて、内容を記述します。

---

## 含めるべき内容

CLAUDE.mdには、Claudeに覚えておいてほしい情報を記載します。

### 1. プロジェクトの概要

プロジェクトの目的や背景を簡潔に説明します。

```markdown
# プロジェクト概要

このプロジェクトは、タスク管理アプリのWebアプリケーションです。
React + TypeScriptでフロントエンド、Node.js + Expressでバックエンドを構築しています。
```

---

### 2. よく使うコマンド

開発中によく実行するコマンドを記載します。

```markdown
## よく使うコマンド

- **開発サーバー起動**: `npm run dev`
- **ビルド**: `npm run build`
- **テスト実行**: `npm run test`
- **Lint実行**: `npm run lint`
- **Lintエラー自動修正**: `npm run lint:fix`
```

Claudeに「ビルドを実行して」と指示すると、自動的に`npm run build`を実行してくれます。

---

### 3. コーディング規約・スタイルガイド

プロジェクトのコーディング規約を明記します。

```markdown
## コーディング規約

### 命名規則
- **変数・関数**: キャメルケース（例: `getUserName`）
- **定数**: アッパースネークケース（例: `MAX_COUNT`）
- **コンポーネント**: パスカルケース（例: `UserProfile`）
- **ファイル名**: ケバブケース（例: `user-profile.tsx`）

### スタイル
- インデント: スペース2つ
- 文字列リテラル: シングルクォート使用
- セミコロン: 必須
- コメント: 日本語OK

### Reactのルール
- Functional Componentを使用
- Hooksを積極的に活用
- PropTypesではなくTypeScriptの型定義を使用
```

---

### 4. ディレクトリ構造

プロジェクトのディレクトリ構造を説明します。

```markdown
## ディレクトリ構造

```
src/
├── components/      # 再利用可能なUIコンポーネント
├── pages/          # ページコンポーネント（ルーティング）
├── hooks/          # カスタムHooks
├── utils/          # ユーティリティ関数
├── services/       # APIクライアント
├── types/          # TypeScript型定義
├── styles/         # グローバルスタイル
└── tests/          # テストファイル
```
```

---

### 5. 技術スタック

使用している主要な技術を記載します。

```markdown
## 技術スタック

### フロントエンド
- React 18.2
- TypeScript 5.0
- Vite（ビルドツール）
- React Router（ルーティング）
- Zustand（状態管理）
- TailwindCSS（スタイリング）

### バックエンド
- Node.js 20.x
- Express 4.18
- PostgreSQL 15
- Prisma（ORM）

### テスト
- Vitest（ユニットテスト）
- React Testing Library（コンポーネントテスト）
- Playwright（E2Eテスト）
```

---

### 6. 重要な設計パターン

プロジェクト特有の設計パターンやアーキテクチャを説明します。

```markdown
## 設計パターン

### コンポーネント設計
- Atomic Design原則に従う
- atoms/molecules/organisms/templates/pagesの階層構造

### 状態管理
- グローバル状態: Zustandを使用
- サーバー状態: React Queryを使用
- フォーム状態: React Hook Formを使用

### API通信
- すべてのAPI呼び出しは`src/services/`に集約
- エラーハンドリングは共通関数`handleApiError()`を使用
```

---

### 7. 注意事項・制約

プロジェクト固有の制約や注意事項を記載します。

```markdown
## 注意事項

- このプロジェクトは IE11 をサポートしていません
- 画像ファイルは必ず最適化してから使用すること（WebP推奨）
- APIリクエストにはレートリミットがあります（1分あたり60リクエスト）
- 本番環境では環境変数`VITE_API_URL`を使用してAPIエンドポイントを設定
```

---

## 実践的な例

### 例1: シンプルなWebアプリ

```markdown
# タスク管理アプリ

## プロジェクト概要
個人用のタスク管理Webアプリケーション。
React + Viteで構築し、バックエンドはSupabaseを使用。

## よく使うコマンド
- 開発サーバー: `npm run dev`
- ビルド: `npm run build`
- テスト: `npm test`

## 技術スタック
- React 18
- TypeScript
- Vite
- TailwindCSS
- Supabase

## コーディング規約
- 変数名: キャメルケース
- コンポーネント: パスカルケース
- インデント: スペース2つ
- コメントは日本語でOK

## ディレクトリ構造
- `src/components/`: UIコンポーネント
- `src/pages/`: ページ
- `src/hooks/`: カスタムHooks
- `src/lib/`: ライブラリ（Supabaseクライアントなど）
```

---

### 例2: Node.js APIサーバー

```markdown
# ユーザー管理API

## プロジェクト概要
RESTful APIサーバー。ユーザー認証とCRUD操作を提供。

## よく使うコマンド
- 開発サーバー: `npm run dev`
- ビルド: `npm run build`
- テスト: `npm test`
- Lint: `npm run lint`
- データベースマイグレーション: `npm run db:migrate`

## 技術スタック
- Node.js 20
- Express
- TypeScript
- PostgreSQL
- Prisma (ORM)
- Jest (テスト)

## API設計
- すべてのエンドポイントは `/api/v1` プレフィックス
- 認証: JWT Bearer Token
- エラーレスポンス形式:
  ```json
  {
    "error": {
      "code": "ERROR_CODE",
      "message": "エラーメッセージ"
    }
  }
  ```

## コーディング規約
- 関数名: キャメルケース
- クラス名: パスカルケース
- 定数: アッパースネークケース
- すべての関数にJSDocコメントを追加

## ディレクトリ構造
- `src/routes/`: ルーティング定義
- `src/controllers/`: ビジネスロジック
- `src/services/`: データベースアクセス
- `src/middlewares/`: ミドルウェア
- `src/utils/`: ユーティリティ関数
- `src/types/`: TypeScript型定義

## 注意事項
- 環境変数は`.env`ファイルで管理（`.env.example`を参照）
- データベース接続は`src/lib/db.ts`で一元管理
- すべてのAPIエンドポイントに認証ミドルウェアを適用
```

---

### 例3: 個人開発者のユーザーメモリ

個人的な好みを全プロジェクト共通で適用したい場合、ホームディレクトリに配置します。

**場所:** `~/.config/claude/CLAUDE.md`

```markdown
# 個人設定

## 好みのコーディングスタイル
- コメントは必ず日本語で書いて
- 変数名は説明的に（略語を避ける）
- 複雑なロジックには必ずコメントを追加

## よく使う開発ツール
- エディタ: VS Code
- パッケージマネージャー: npm（yarnは使わない）
- Gitクライアント: ターミナル

## プログラミング言語の好み
- JavaScript: ES6+の構文を積極的に使用
- TypeScript: 型安全性を最優先
- Python: PEP 8に準拠

## コミットメッセージの形式
- プレフィックスを使用:
  - `feat:` 新機能
  - `fix:` バグ修正
  - `docs:` ドキュメント変更
  - `refactor:` リファクタリング
  - `test:` テスト追加・修正
```

---

## ベストプラクティス

### 1. 具体的に書く

曖昧な指示ではなく、具体的で明確な指示を書きます。

**悪い例:**
```markdown
コードをきれいに書いて
```

**良い例:**
```markdown
## コーディング規約
- 1つの関数は最大50行以内
- ネストは3階層まで
- 複雑な条件式は変数に抽出してわかりやすくする
```

---

### 2. 段階的に充実させる

最初から完璧なCLAUDE.mdを作る必要はありません。プロジェクトを進めながら、必要な情報を追加していきましょう。

**推奨フロー:**
1. `/init`で基本的なCLAUDE.mdを作成
2. 開発を進める
3. Claudeに何度も同じ説明をすることに気づく
4. その情報をCLAUDE.mdに追加
5. 繰り返し

---

### 3. チームで共有する場合は相談

チーム開発の場合、CLAUDE.mdはGitでバージョン管理され、全員が見ることになります。追加・変更する際は、チームメンバーと相談しましょう。

---

### 4. 個人的な好みはユーザーメモリに

プロジェクト全体に影響しない、個人的な好みは`~/.config/claude/CLAUDE.md`に記載します。

**プロジェクトメモリ（チーム共有）:**
```markdown
## コーディング規約
- インデント: スペース2つ
- セミコロン: 必須
```

**ユーザーメモリ（個人設定）:**
```markdown
## 個人的な好み
- コメントは日本語で書いて
- 変数名は説明的にして
```

---

### 5. 定期的に見直す

プロジェクトが進化すると、CLAUDE.mdの内容も古くなります。定期的に見直して、最新の状態に保ちましょう。

---

## よくある質問

### Q: CLAUDE.mdはGitにコミットすべき?

**A:** プロジェクトメモリ（ルートディレクトリの`CLAUDE.md`）はコミットすることを推奨します。チームで共有できるため、全員が一貫した指示を受けられます。

ただし、個人的な設定（`.claude/CLAUDE.md`やユーザーメモリ）は`.gitignore`に追加して、コミットしないようにしましょう。

---

### Q: CLAUDE.mdに何を書けばいいかわからない

**A:** まずは`/init`で自動生成し、開発を始めてみましょう。Claudeに何度も同じ説明をする必要があることに気づいたら、その内容をCLAUDE.mdに追加します。

最初から完璧である必要はありません。

---

### Q: CLAUDE.mdが長くなりすぎた

**A:** 情報を整理し、本当に必要な内容だけを残しましょう。以下の基準で判断します:

- **残す**: プロジェクト固有の重要な情報
- **削除**: 一般的な知識（Claudeが既に知っている情報）
- **簡潔に**: 冗長な説明は避ける

---

### Q: CLAUDE.mdを編集したら、すぐに反映される?

**A:** はい、CLAUDE.mdを編集して保存すれば、次のClaude Codeセッションから自動的に読み込まれます。既に起動中のセッションでは、再起動が必要な場合があります。

---

## 次のステップ

CLAUDE.mdの使い方を理解したら、次のガイドに進みましょう:

- [Skillsガイド](./04-skills-guide.md): 独自のスキルを作成する
- [Tips集](./05-tips-and-tricks.md): さらに高度なテクニックを学ぶ

---

**公式ドキュメント:**
- [Memory Management](https://code.claude.com/docs/en/memory.md)
